<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- ê´€ë¦¬ìž -->
<!-- ê´€ë¦¬ìž -->
<!-- ê´€ë¦¬ìž -->
<mapper namespace="com.fortrip.com.domain.admin.home.model.mapper.MemberInfoMapper">

	<!-- ì „ì²´ íšŒì› ìˆ˜ -->
	<select id="getMemberCount" resultType="_int">
		SELECT COUNT(*) FROM MEMBER WHERE NOT STATUS_YSN = 'N'
	</select>
	
	<!-- í™œì„± íšŒì› ìˆ˜ -->
	<select id="getMemberActive" resultType="_int">
		SELECT COUNT(*) FROM MEMBER WHERE STATUS_YSN = 'Y'
	</select>
	
	<!-- ë¹„í™œì„± íšŒì› ìˆ˜ -->
	<select id="getMemberStop" resultType="_int">
		SELECT COUNT(*) FROM MEMBER WHERE STATUS_YSN = 'S'
	</select>
	
	<!-- íšŒì› íŽ˜ì´ì§• ë¦¬ìŠ¤íŠ¸ -->
	<select id="userList" resultType="MemberVO">
		SELECT * FROM MEMBER WHERE NOT STATUS_YSN = 'N' ORDER BY MEMBER_NO
	</select>
	<select id="getTotalCount" resultType="_int">
		SELECT COUNT(*) FROM MEMBER WHERE NOT STATUS_YSN = 'N'
	</select>
	<!-- íšŒì› íŽ˜ì´ì§• ë -->
	
	
	<!-- íšŒì› ê°€ìž… ì°¨íŠ¸ -->
	<select id="getSignupChart" resultType="map">
		SELECT 
		    TO_CHAR(ENROLL_DATE, 'YYYY-MM') AS month, 
		    COUNT(*) AS join_count
		FROM MEMBER
		WHERE ENROLL_DATE >= ADD_MONTHS(SYSDATE, -12) AND
		STATUS_YSN = 'N'
		GROUP BY TO_CHAR(ENROLL_DATE, 'YYYY-MM')
		ORDER BY month ASC
	</select>
	<!-- íšŒì› ê°€ìž… ì°¨íŠ¸ ë -->
	
	<!-- í‚¤ì›Œë“œ ì°¨íŠ¸ -->
	<select id="getKeyWordChart" resultType="map">
		SELECT
        	SEARCH_KEYWORD AS keyword,
        	COUNT(*) AS count
    	FROM SEARCH_LOG
    	GROUP BY SEARCH_KEYWORD
    	ORDER BY COUNT(*) DESC
	</select>
	<!-- í‚¤ì›Œë“œ ì°¨íŠ¸ ë -->
	
	<!-- íšŒì› ê°•ì œ íƒˆí‡´ ì²˜ë¦¬ -->
	<delete id="userDelete">
		UPDATE MEMBER SET STATUS_YSN = 'N' WHERE MEMBER_NO = #{memberNo}
	</delete>
	<!-- íšŒì› ê°•ì œ íƒˆí‡´ ì²˜ë¦¬ -->
	
	<!-- ðŸ”¹ íšŒì› ê²€ìƒ‰ ì¹´ìš´íŠ¸ -->
	<select id="getSearchCount" resultType="_int">
		SELECT COUNT(*) 
		FROM MEMBER 
		WHERE NOT STATUS_YSN = 'N'
		  AND (
		    MEMBER_ID LIKE '%' || #{keyword} || '%'
		    OR MEMBER_NAME LIKE '%' || #{keyword} || '%'
		    OR NICKNAME LIKE '%' || #{keyword} || '%'
		  )
	</select>
	
	
	<!-- ðŸ”¹ íšŒì› ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ -->
	<select id="userSearchList" resultType="MemberVO">
		SELECT * 
		FROM MEMBER 
		WHERE NOT STATUS_YSN = 'N'
		  AND (
		    MEMBER_ID LIKE '%' || #{keyword} || '%'
		    OR MEMBER_NAME LIKE '%' || #{keyword} || '%'
		    OR NICKNAME LIKE '%' || #{keyword} || '%'
		  )
		ORDER BY MEMBER_NO
	</select>
	<!-- íšŒì› ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ ë -->
	
	<!-- íšŒì› í•„í„° ì¹´ìš´íŠ¸ -->
	<select id="getFillterCount" resultType="_int">
		SELECT COUNT(*) FROM MEMBER  
		<where>
			NOT STATUS_YSN = 'N'
			<choose>
				<when test="filter == 'active'">
					AND STATUS_YSN = 'Y'
				</when>
				<when test="filter == 'inactive'">
					AND STATUS_YSN = 'S'
				</when>
				<when test="filter == 'man'">
					AND GENDER = 'M'
				</when>
				<when test="filter == 'girl'">
					AND GENDER = 'F'
				</when>
			</choose>
		</where>
	</select>
	<!-- íšŒì› í•„í„° ì¹´ìš´íŠ¸ ë -->
	
	<!-- íšŒì› í•„í„° ë¦¬ìŠ¤íŠ¸ -->
	<select id="userFillterList" resultType="MemberVO">
		SELECT * FROM MEMBER
		<where>
			NOT STATUS_YSN = 'N'
			<choose>
				<when test="filter == 'active'">
					AND STATUS_YSN = 'Y'
				</when>
				<when test="filter == 'inactive'">
					AND STATUS_YSN = 'S'
				</when>
				<when test="filter == 'man'">
					AND GENDER = 'M'
				</when>
				<when test="filter == 'girl'">
					AND GENDER = 'F'
				</when>
			</choose>
		</where>
			ORDER BY MEMBER_NO
	</select>
	<!-- íšŒì› í•„í„° ë¦¬ìŠ¤íŠ¸ ë -->

</mapper>