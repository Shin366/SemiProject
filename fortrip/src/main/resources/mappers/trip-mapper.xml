<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fortrip.com.domain.journey.trip.model.mapper.TripMapper">
<!-- 공통 WHERE -->
  <sql id="baseWhere">
    WHERE TYPE = 'TRAVEL'
      AND NVL(DELETE_YN,'N') = 'N'
    <if test="destination != null and destination != ''">
      AND (
           LOWER(ROAD_NAME)     LIKE '%' || LOWER(#{destination}) || '%'
        OR LOWER(ROAD_LOCATION) LIKE '%' || LOWER(#{destination}) || '%'
      )
    </if>
  </sql>

  <!-- 목록 (검색 + 페이징) -->
  <select id="selectTrips" resultType="com.fortrip.com.domain.journey.trip.model.vo.Trip">
    SELECT
      ROAD_NO        AS roadNo,
      ROAD_NAME      AS roadName,
      ROAD_START     AS roadStart,
      ROAD_END       AS roadEnd,
      ROAD_LOCATION  AS roadLocation,
      ROAD_YN        AS roadYn,
      ROAD_COST      AS roadCost,
      ROAD_STYLE     AS roadStyle,
      ROAD_INTRO     AS roadIntro,
      DELETE_YN      AS deleteYn,
      WRITE_DATE     AS writeDate,
      TYPE           AS type,
      MEMBER_ID      AS memberId
    FROM ROAD
    <include refid="baseWhere"/>
    ORDER BY WRITE_DATE DESC NULLS LAST, ROAD_NO DESC
    OFFSET #{offset} ROWS FETCH NEXT #{size} ROWS ONLY
  </select>

  <!-- 총 건수 -->
  <select id="countTrips" resultType="int">
    SELECT COUNT(*)
    FROM ROAD
    <include refid="baseWhere"/>
  </select>

  <!-- 상세 -->
  <select id="selectTripById" parameterType="int"
          resultType="com.fortrip.com.domain.journey.trip.model.vo.Trip">
    SELECT
      ROAD_NO        AS roadNo,
      ROAD_NAME      AS roadName,
      ROAD_START     AS roadStart,
      ROAD_END       AS roadEnd,
      ROAD_LOCATION  AS roadLocation,
      ROAD_YN        AS roadYn,
      ROAD_COST      AS roadCost,
      ROAD_STYLE     AS roadStyle,
      ROAD_INTRO     AS roadIntro,
      DELETE_YN      AS deleteYn,
      WRITE_DATE     AS writeDate,
      TYPE           AS type,
      MEMBER_ID      AS memberId
    FROM ROAD
    WHERE ROAD_NO = #{id}
      AND TYPE = 'TRAVEL'
      AND NVL(DELETE_YN,'N') = 'N'
  </select>
</mapper>